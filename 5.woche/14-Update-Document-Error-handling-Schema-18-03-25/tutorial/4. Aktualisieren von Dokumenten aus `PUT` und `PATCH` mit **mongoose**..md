## **4. Aktualisieren von Dokumenten mit `PUT` und `PATCH` in Mongoose**
(**Mongoose ile Belgeleri GÃ¼ncelleme: `PUT` ve `PATCH` ArasÄ±ndaki Farklar**)

MongoDB'de **verileri gÃ¼ncellemek iÃ§in** iki farklÄ± HTTP metodu kullanÄ±lÄ±r:  
- **`PUT` (Tam GÃ¼ncelleme â€“ Full Update)**  
- **`PATCH` (KÄ±smi GÃ¼ncelleme â€“ Partial Update)**  

---

## **ğŸ“Œ 4.1. `PUT` vs. `PATCH` ArasÄ±ndaki Fark**
| **Ã–zellik**  | **`PUT` (Tam GÃ¼ncelleme)** | **`PATCH` (KÄ±smi GÃ¼ncelleme)** |
|--------------|--------------------------|--------------------------|
| **AmaÃ§** | Belgeyi tamamen deÄŸiÅŸtirmek | Belgenin sadece belirli alanlarÄ±nÄ± deÄŸiÅŸtirmek |
| **Eksik Alanlar** | Eksik alanlar **silinir** (override olur) | Eksik alanlar **deÄŸiÅŸmez** |
| **Performans** | Daha fazla iÅŸlem gerektirir | Daha hÄ±zlÄ±dÄ±r, Ã§Ã¼nkÃ¼ sadece gerekli alanlarÄ± gÃ¼nceller |
| **Ne Zaman KullanÄ±lÄ±r?** | Bir nesnenin **tamamÄ±nÄ± deÄŸiÅŸtirmek** istiyorsan | Sadece **bazÄ± alanlarÄ± gÃ¼ncellemek** istiyorsan |

ğŸ”¹ **`PUT` kullanÄ±rken eksik alanlarÄ± gÃ¶ndermeyi unutursan, mevcut deÄŸerler silinir!**  
ğŸ”¹ **`PATCH` ise sadece gÃ¶nderilen alanlarÄ± deÄŸiÅŸtirir, diÄŸerlerini korur.**  

---

## **ğŸ“Œ 4.2. `PUT` ile GÃ¼ncelleme (Full Update â€“ TÃ¼m AlanlarÄ± GÃ¼ncelleme)**  
- **TÃ¼m belgeyi (`document`) yeni deÄŸerlerle deÄŸiÅŸtirir.**  
- **Eksik alanlar `null` veya `undefined` olabilir.**  

### **Ã–rnek: KullanÄ±cÄ±yÄ± `PUT` ile GÃ¼ncelleme**
```js
const updateUser = async (req, res) => {
  try {
    const user = await User.findByIdAndUpdate(
      req.params.id, // ğŸ”¹ GÃ¼ncellenecek kullanÄ±cÄ± ID'si
      req.body,      // ğŸ”¹ Yeni veriler
      { new: true, runValidators: true } // ğŸ”¹ Yeni belgeyi dÃ¶ndÃ¼r + ValidasyonlarÄ± Ã§alÄ±ÅŸtÄ±r
    );

    if (!user) return res.status(404).json({ msg: "Benutzer nicht gefunden!" });

    res.json({ msg: "Benutzer erfolgreich aktualisiert!", user });
  } catch (error) {
    res.status(500).json({ error });
  }
};
```

âœ… **Postman'de `PUT /users/:id` Ä°steÄŸi:**  
```json
{
  "firstName": "John",
  "lastName": "Doe",
  "email": "john.doe@example.com",
  "age": 30
}
```
ğŸ’¡ **EÄŸer `age` alanÄ±nÄ± gÃ¶ndermezsek, eski `age` deÄŸeri `undefined` olur!**  

---

## **ğŸ“Œ 4.3. `PATCH` ile GÃ¼ncelleme (Partial Update â€“ KÄ±smi GÃ¼ncelleme)**
- **Sadece gÃ¶nderilen alanlarÄ± gÃ¼nceller.**  
- **Eksik alanlar deÄŸiÅŸtirilmez, eski deÄŸerlerini korur.**  

### **Ã–rnek: KullanÄ±cÄ±yÄ± `PATCH` ile GÃ¼ncelleme**
```js
const patchUser = async (req, res) => {
  try {
    const user = await User.findByIdAndUpdate(
      req.params.id, 
      { $set: req.body }, // ğŸ”¹ Sadece gÃ¶nderilen alanlarÄ± deÄŸiÅŸtir
      { new: true, runValidators: true }
    );

    if (!user) return res.status(404).json({ msg: "Benutzer nicht gefunden!" });

    res.json({ msg: "Benutzer erfolgreich aktualisiert!", user });
  } catch (error) {
    res.status(500).json({ error });
  }
};
```

âœ… **Postman'de `PATCH /users/:id` Ä°steÄŸi:**  
```json
{
  "age": 35
}
```
ğŸ’¡ **Sadece `age` alanÄ± gÃ¼ncellenecek, diÄŸer alanlar deÄŸiÅŸmeden kalacaktÄ±r!**  

---

## **ğŸ“Œ 4.4. `PUT` ve `PATCH` iÃ§in `runValidators` KullanÄ±mÄ±**
EÄŸer `PUT` veya `PATCH` kullanÄ±yorsan, **Mongooseâ€™un validasyonlarÄ±nÄ± (`required`, `minlength`, vb.) Ã§alÄ±ÅŸtÄ±rmak iÃ§in `runValidators: true` eklemelisin.**  

### **Ã–rnek: `PUT` ve `PATCH` iÃ§in DoÄŸrulama AÃ§Ä±k**
```js
const updateUser = async (req, res) => {
  try {
    const user = await User.findByIdAndUpdate(req.params.id, req.body, { 
      new: true, 
      runValidators: true // ğŸ”¹ Validatorleri Ã§alÄ±ÅŸtÄ±r
    });

    if (!user) return res.status(404).json({ msg: "Benutzer nicht gefunden!" });

    res.json({ msg: "Benutzer erfolgreich aktualisiert!", user });
  } catch (error) {
    res.status(500).json({ error });
  }
};
```

âœ… **EÄŸer kullanÄ±cÄ± `age: 10` gÃ¶nderirse ve yaÅŸ sÄ±nÄ±rÄ±mÄ±z `min: 18` ise hata alÄ±rÄ±z!** ğŸš€  

---

## **ğŸ“Œ 4.5. `findByIdAndUpdate()` vs. `save()`**
| **YÃ¶ntem**  | **Ne Zaman KullanÄ±lÄ±r?** | **Avantaj** | **Dezavantaj** |
|------------|----------------|-----------------|----------------|
| **`findByIdAndUpdate()`** | GÃ¼ncelleme iÃ§in yaygÄ±n olarak kullanÄ±lÄ±r | Daha hÄ±zlÄ±dÄ±r, Ã§Ã¼nkÃ¼ doÄŸrudan DBâ€™de deÄŸiÅŸiklik yapar | Middleware (`pre` veya `post` hooks) Ã§alÄ±ÅŸmaz |
| **`save()`** | Ã–zel doÄŸrulamalar (`middleware`) Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanÄ±lÄ±r | `pre` ve `post` middlewareâ€™ler Ã§alÄ±ÅŸÄ±r | Daha fazla bellek kullanÄ±r, Ã§Ã¼nkÃ¼ Ã¶nce veriyi alÄ±r sonra gÃ¼nceller |

### **Ã–rnek: `save()` Kullanarak GÃ¼ncelleme**
```js
const updateUserWithSave = async (req, res) => {
  try {
    const user = await User.findById(req.params.id);
    if (!user) return res.status(404).json({ msg: "Benutzer nicht gefunden!" });

    // ğŸ”¹ GÃ¼ncellenmek istenen alanlarÄ± tek tek deÄŸiÅŸtiriyoruz
    if (req.body.firstName) user.firstName = req.body.firstName;
    if (req.body.age) user.age = req.body.age;

    await user.save(); // ğŸ”¹ DeÄŸiÅŸiklikleri kaydet

    res.json({ msg: "Benutzer erfolgreich aktualisiert!", user });
  } catch (error) {
    res.status(500).json({ error });
  }
};
```
âœ… **BÃ¶ylece `pre` ve `post` middlewareâ€™ler Ã§alÄ±ÅŸÄ±r.**  

---

## **ğŸ“Œ 4.6. `PUT` ve `PATCH` KullanÄ±mÄ± Ä°Ã§in Ã–zet**
| **HTTP Metodu**  | **Ne Zaman KullanÄ±lÄ±r?** | **Eksik Alanlar** | **Performans** |
|----------------|------------------|--------------|--------------|
| **`PUT` (Full Update)** | TÃ¼m belgeyi gÃ¼ncellemek iÃ§in | Eski alanlarÄ± siler | Daha yavaÅŸ |
| **`PATCH` (Partial Update)** | Sadece belirli alanlarÄ± deÄŸiÅŸtirmek iÃ§in | Eski alanlarÄ± korur | Daha hÄ±zlÄ± |

ğŸš€ **Genellikle `PATCH` kullanÄ±mÄ± `PUT`â€™a gÃ¶re daha gÃ¼venlidir!**  

---

## **ğŸ“Œ 4.7. SonuÃ§**
ğŸ¯ **`PUT` â†’ TÃ¼m belgeyi deÄŸiÅŸtirmek iÃ§in kullanÄ±lÄ±r. Eksik alanlar silinir!**  
ğŸ¯ **`PATCH` â†’ Sadece belirli alanlarÄ± gÃ¼nceller, diÄŸerlerini korur.**  
ğŸ¯ **`runValidators: true` â†’ GÃ¼ncellemelerde doÄŸrulama hatalarÄ±nÄ± yakalamak iÃ§in gereklidir.**  

âœ… **Veriyi tamamen deÄŸiÅŸtirmek iÃ§in `PUT`, sadece gerekli alanlarÄ± gÃ¼ncellemek iÃ§in `PATCH` kullan!** ğŸš€