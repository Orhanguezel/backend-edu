### **ğŸ“Œ Mongoose'da Schema NasÄ±l DoÄŸrulanÄ±r (Validation)?**
Mongoose, **veritabanÄ±na veri eklerken belirli kurallara uymayÄ± zorunlu kÄ±lan bir doÄŸrulama (validation) mekanizmasÄ± sunar.**  
Bu sayede **hatalÄ± veya eksik veri giriÅŸini engelleyebiliriz.**  

---

## **âœ… Mongoose'da DoÄŸrulama YÃ¶ntemleri**
Mongoose'da **doÄŸrulama iÅŸlemi 3 farklÄ± ÅŸekilde yapÄ±labilir**:

1ï¸âƒ£ **YerleÅŸik (Built-in) DoÄŸrulayÄ±cÄ±lar** â†’ `required`, `min`, `max`, `enum`, `match` vb.  
2ï¸âƒ£ **Ã–zel DoÄŸrulayÄ±cÄ±lar (`validate` fonksiyonu ile)**  
3ï¸âƒ£ **Middleware (Pre ve Post Hooks)**  

---

## **1ï¸âƒ£ YerleÅŸik (`Built-in`) DoÄŸrulamalar**
Mongoose, sÄ±k kullanÄ±lan doÄŸrulamalarÄ± **yerleÅŸik olarak destekler.**  
ğŸ“Œ **Ã–rnek: `required`, `min`, `max`, `match`, `enum` kullanÄ±mÄ±**  
```javascript
const userSchema = new mongoose.Schema({
  name: { type: String, required: true },  // Zorunlu alan
  age: { type: Number, min: 18, max: 99 }, // 18 ile 99 arasÄ±nda olmalÄ±
  email: { type: String, required: true, match: /.+\@.+\..+/ }, // GeÃ§erli e-posta formatÄ±
  role: { type: String, enum: ["admin", "user", "guest"] } // Sadece belirli deÄŸerler olabilir
});
```
### **ğŸ“Œ AÃ§Ä±klamalar:**
âœ… **`required: true`** â†’ `name` ve `email` alanlarÄ±nÄ± zorunlu hale getirir.  
âœ… **`min: 18` ve `max: 99`** â†’ `age` deÄŸerinin en az 18, en fazla 99 olmasÄ±nÄ± saÄŸlar.  
âœ… **`match: /.+\@.+\..+/`** â†’ `email` iÃ§in geÃ§erli bir e-posta formatÄ±nÄ± zorunlu kÄ±lar.  
âœ… **`enum`** â†’ `role` sadece `"admin"`, `"user"`, `"guest"` olabilir.  

---

## **2ï¸âƒ£ Ã–zel DoÄŸrulamalar (`validate` fonksiyonu)**
BazÄ± durumlarda, **yerleÅŸik doÄŸrulamalar yeterli olmaz** ve **Ã¶zel doÄŸrulama fonksiyonlarÄ±** tanÄ±mlamamÄ±z gerekir.  
ğŸ“Œ **Ã–rnek: Telefon numarasÄ± doÄŸrulamasÄ±**
```javascript
const userSchema = new mongoose.Schema({
  phone: {
    type: String,
    validate: {
      validator: function(v) {
        return /\d{3}-\d{3}-\d{4}/.test(v);  // "123-456-7890" formatÄ±nÄ± kontrol eder
      },
      message: props => `${props.value} geÃ§erli bir telefon numarasÄ± deÄŸil!`
    }
  }
});
```
### **ğŸ“Œ AÃ§Ä±klamalar:**
âœ… **Fonksiyon `v` parametresini alÄ±r ve bir regex ile doÄŸrular.**  
âœ… **EÄŸer veri formatÄ± yanlÄ±ÅŸsa, `"GeÃ§erli bir telefon numarasÄ± deÄŸil!"` mesajÄ±nÄ± dÃ¶ndÃ¼rÃ¼r.**  

---

## **3ï¸âƒ£ Middleware (Pre ve Post Hooks) ile DoÄŸrulama**
**Middleware (ara katman fonksiyonlarÄ±)** sayesinde, **veritabanÄ±na kaydetmeden Ã¶nce (`pre`) veya sonra (`post`) doÄŸrulama yapabiliriz.**  
ğŸ“Œ **Ã–rnek: `pre` ile kullanÄ±cÄ± adÄ±nÄ± kÃ¼Ã§Ã¼k harfe Ã§evirme**
```javascript
userSchema.pre("save", function(next) {
  this.username = this.username.toLowerCase(); // KÃ¼Ã§Ã¼k harfe Ã§evir
  next();
});
```
ğŸ“Œ **Ã–rnek: `post` ile hata kontrolÃ¼**
```javascript
userSchema.post("save", function(doc, next) {
  console.log(`Yeni kullanÄ±cÄ± eklendi: ${doc.name}`);
  next();
});
```
### **ğŸ“Œ AÃ§Ä±klamalar:**
âœ… **`pre("save")` â†’ Kaydetmeden Ã¶nce `username` deÄŸerini kÃ¼Ã§Ã¼k harfe Ã§evirir.**  
âœ… **`post("save")` â†’ Kaydettikten sonra mesaj yazdÄ±rÄ±r.**  

---

## **âœ… Veriyi DoÄŸrulama ve Hata YÃ¶netimi**
Mongoose'daki doÄŸrulamalarÄ± test etmek iÃ§in **`validate()` veya `save()`** kullanÄ±labilir.  
ğŸ“Œ **Ã–rnek: DoÄŸrulama testi ve hata yÃ¶netimi**
```javascript
const User = mongoose.model("User", userSchema);

const newUser = new User({
  name: "", // âŒ GeÃ§ersiz, Ã§Ã¼nkÃ¼ required
  age: 15,  // âŒ GeÃ§ersiz, Ã§Ã¼nkÃ¼ min: 18
  email: "yanlisformat", // âŒ GeÃ§ersiz, Ã§Ã¼nkÃ¼ match saÄŸlanmÄ±yor
  role: "superadmin" // âŒ GeÃ§ersiz, Ã§Ã¼nkÃ¼ enum dÄ±ÅŸÄ±nda
});

newUser.validate()
  .then(() => console.log("âœ… DoÄŸrulama baÅŸarÄ±lÄ±!"))
  .catch(err => console.error("âŒ DoÄŸrulama hatasÄ±:", err.message));
```
ğŸ“Œ **SonuÃ§:**
```sh
âŒ DoÄŸrulama hatasÄ±: Path `name` is required.
âŒ DoÄŸrulama hatasÄ±: Path `age` (15) is less than minimum allowed value (18).
âŒ DoÄŸrulama hatasÄ±: Path `email` is invalid.
âŒ DoÄŸrulama hatasÄ±: `superadmin` is not a valid enum value.
```
ğŸš€ **Mongoose'un hata mesajlarÄ±yla hangi alanlarÄ±n yanlÄ±ÅŸ olduÄŸunu gÃ¶rebiliriz!** ğŸš€  

---

## **ğŸ“Œ Ã–zet**
| **DoÄŸrulama YÃ¶ntemi** | **KullanÄ±m AlanÄ±** | **Ã–rnek** |
|-------------------|-----------------|-------------------|
| **Built-in Validators** | `required`, `min`, `max`, `enum`, `match` | `email: { type: String, required: true }` |
| **Custom Validators** | Regex veya Ã¶zel fonksiyon ile doÄŸrulama | `phone: { type: String, validate: { validator: fn } }` |
| **Middleware (Hooks)** | Kaydetmeden Ã¶nce/sonra veri deÄŸiÅŸtirme veya kontrol | `pre("save", fn)` |

âœ… **Mongoose doÄŸrulamalar sayesinde verilerin tutarlÄ± ve hatasÄ±z olmasÄ±nÄ± saÄŸlar!**  
âœ… **HatalÄ± veri giriÅŸini engelleyerek veritabanÄ±nÄ± korur.**  

ğŸš€ **Åimdi, doÄŸrulama testlerini Postman veya bir API endpointi Ã¼zerinden test edebilirsin!** ğŸš€