## **3. Erstellen einer API fÃ¼r Erstellen, Lesen und LÃ¶schen von Daten**  

Nachdem wir gelernt haben, **wie man Mock-Daten generiert**, wollen wir nun eine **einfache CRUD-API mit Express und MongoDB** erstellen.  
Diese API wird die folgenden Funktionen enthalten:  

âœ… **Erstellen (`POST`)** â€“ Einen neuen Datensatz in der MongoDB speichern  
âœ… **Lesen (`GET`)** â€“ Daten aus der MongoDB abrufen  
âœ… **LÃ¶schen (`DELETE`)** â€“ Daten aus der MongoDB entfernen  

---

## **ğŸ”¹ 1. Projekt einrichten**  

Falls du noch kein **Node.js-Projekt** hast, erstelle es mit:  

```bash
mkdir mock-api && cd mock-api
npm init -y
```

Dann installieren wir die benÃ¶tigten Pakete:  

```bash
npm install express mongoose cors dotenv
```

ğŸ“Œ **Was bedeuten diese Pakete?**  
- **express** â†’ Das Web-Framework fÃ¼r die API  
- **mongoose** â†’ Verbindet Node.js mit MongoDB  
- **cors** â†’ Erlaubt externe API-Anfragen  
- **dotenv** â†’ Verwaltet Umgebungsvariablen (`.env`)  

---

## **ğŸ”¹ 2. MongoDB Verbindung (`db.js`)**
Wir erstellen eine **Datenbankverbindung mit Mongoose**.

ğŸ“Œ **Datei: `db.js`**  
```javascript
import mongoose from "mongoose";
import dotenv from "dotenv";

dotenv.config();

const connectDB = async () => {
  try {
    await mongoose.connect(process.env.MONGO_URL, {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    });
    console.log("âœ… MongoDB connected!");
  } catch (error) {
    console.error("âŒ MongoDB connection failed:", error.message);
    process.exit(1);
  }
};

export default connectDB;
```

ğŸ‘‰ **Erstelle eine `.env` Datei und trage die Verbindung zur Datenbank ein:**  
```
MONGO_URL=mongodb://localhost:27017/mockDB
```

---

## **ğŸ”¹ 3. Datenmodell (`models.js`)**
Nun definieren wir ein **Mongoose Schema fÃ¼r unsere Nutzerdaten**.

ğŸ“Œ **Datei: `models.js`**  
```javascript
import mongoose from "mongoose";

const userSchema = new mongoose.Schema({
  name: String,
  email: String,
  phone: String,
  address: String,
});

const User = mongoose.model("User", userSchema);
export default User;
```

---

## **ğŸ”¹ 4. Express API erstellen (`server.js`)**  

Nun erstellen wir eine **Express API mit den CRUD-Routen**.

ğŸ“Œ **Datei: `server.js`**  
```javascript
import express from "express";
import connectDB from "./db.js";
import User from "./models.js";
import dotenv from "dotenv";
import cors from "cors";

dotenv.config();
const app = express();

// Middleware
app.use(cors());
app.use(express.json());

// Datenbankverbindung
connectDB();

// ğŸ“Œ 1. GET: Alle Benutzer abrufen
app.get("/api/users", async (req, res) => {
  try {
    const users = await User.find();
    res.json(users);
  } catch (error) {
    res.status(500).json({ error: "Fehler beim Abrufen der Daten" });
  }
});

// ğŸ“Œ 2. POST: Neuen Benutzer hinzufÃ¼gen
app.post("/api/users", async (req, res) => {
  try {
    const newUser = new User(req.body);
    await newUser.save();
    res.status(201).json(newUser);
  } catch (error) {
    res.status(400).json({ error: "Fehler beim Speichern der Daten" });
  }
});

// ğŸ“Œ 3. DELETE: Benutzer lÃ¶schen
app.delete("/api/users/:id", async (req, res) => {
  try {
    await User.findByIdAndDelete(req.params.id);
    res.json({ message: "Benutzer gelÃ¶scht!" });
  } catch (error) {
    res.status(500).json({ error: "Fehler beim LÃ¶schen der Daten" });
  }
});

// Server starten
const PORT = process.env.PORT || 5000;
app.listen(PORT, () => console.log(`ğŸš€ Server lÃ¤uft auf Port ${PORT}`));
```

---

## **ğŸ”¹ 5. API testen**
Starte den Server mit:  
```bash
node server.js
```
Wenn alles korrekt ist, siehst du:
```
âœ… MongoDB connected!
ğŸš€ Server lÃ¤uft auf Port 5000
```

Nun kannst du die API testen:

ğŸ“Œ **GET alle Benutzer abrufen:**  
```bash
curl -X GET http://localhost:5000/api/users
```

ğŸ“Œ **POST neuen Benutzer hinzufÃ¼gen:**  
```bash
curl -X POST http://localhost:5000/api/users -H "Content-Type: application/json" -d '{
  "name": "Max Mustermann",
  "email": "max@example.com",
  "phone": "+49 176 987654",
  "address": "MusterstraÃŸe 12, 12345 Musterstadt"
}'
```

ğŸ“Œ **DELETE Benutzer lÃ¶schen:**  
```bash
curl -X DELETE http://localhost:5000/api/users/{ID}
```
(Ersetze `{ID}` mit einer tatsÃ¤chlichen Benutzer-ID aus der Datenbank.)

---

## **ğŸš€ Fazit**
âœ… **Wir haben eine API mit MongoDB und Express erstellt, die CRUD-Funktionen unterstÃ¼tzt:**  
- `GET /api/users` â†’ Alle Benutzer abrufen  
- `POST /api/users` â†’ Neuen Benutzer erstellen  
- `DELETE /api/users/:id` â†’ Benutzer lÃ¶schen  

ğŸ“Œ **Die API kann jetzt mit Mock-Daten befÃ¼llt und weiterentwickelt werden!** ğŸš€




### **3. API OluÅŸturma: Verileri Eklemek, Okumak ve Silmek (CRUD Ä°ÅŸlemleri)**

Mock verileri oluÅŸturduktan sonra, bu verileri bir **API** Ã¼zerinden yÃ¶netmek iÃ§in CRUD (Create, Read, Delete) iÅŸlemleri gerÃ§ekleÅŸtireceÄŸiz. CRUD iÅŸlemleri, herhangi bir veri tabanÄ± yÃ¶netimi iÃ§in temel iÅŸlemlerdir ve aÅŸaÄŸÄ±daki gibi tanÄ±mlanÄ±r:

- **C**reate (OluÅŸtur): Yeni bir veri ekleme
- **R**ead (Okuma): Var olan verileri listeleme veya belirli bir veriyi Ã§ekme
- **U**pdate (GÃ¼ncelleme) â†’ (Bu aÅŸamada iÅŸlemeyeceÄŸiz)
- **D**elete (Silme): Bir veriyi sistemden kaldÄ±rma

Bu iÅŸlemleri **Node.js, Express.js ve MongoDB** kullanarak nasÄ±l gerÃ§ekleÅŸtireceÄŸimizi detaylÄ± ÅŸekilde aÃ§Ä±klayacaÄŸÄ±m.

---

## **1. Gerekli BaÄŸÄ±mlÄ±lÄ±klarÄ± Kurma**
Ã–ncelikle **Express.js ve Mongoose** (MongoDB iÃ§in) gibi gerekli paketleri projemize ekleyelim:

```sh
npm init -y
npm install express mongoose dotenv cors
```

- **express:** API oluÅŸturmak iÃ§in
- **mongoose:** MongoDB ile baÄŸlantÄ± kurmak iÃ§in
- **dotenv:** Ã‡evresel deÄŸiÅŸkenler yÃ¶netmek iÃ§in
- **cors:** FarklÄ± kaynaklardan gelen istekleri yÃ¶netmek iÃ§in

---

## **2. MongoDB BaÄŸlantÄ±sÄ± Kurma**
MongoDB ile baÄŸlantÄ± kurmak iÃ§in `.env` dosyasÄ±nda bir baÄŸlantÄ± adresi tanÄ±mlayalÄ±m:

**`.env` DosyasÄ±:**
```env
MONGO_URI=mongodb://localhost:27017/mockDB
PORT=5000
```

ArdÄ±ndan `server.js` dosyasÄ±nda **MongoDB baÄŸlantÄ±sÄ±nÄ±** oluÅŸturalÄ±m:

```javascript
import express from 'express';
import mongoose from 'mongoose';
import dotenv from 'dotenv';
import cors from 'cors';

dotenv.config();  // .env dosyasÄ±nÄ± kullan

const app = express();
app.use(express.json()); // JSON verilerini okumak iÃ§in
app.use(cors()); // CORS hatalarÄ±nÄ± Ã¶nlemek iÃ§in

// MongoDB baÄŸlantÄ±sÄ±
mongoose.connect(process.env.MONGO_URI, {
  useNewUrlParser: true,
  useUnifiedTopology: true
}).then(() => console.log("MongoDB baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±"))
  .catch(err => console.error("MongoDB baÄŸlantÄ± hatasÄ±:", err));

const PORT = process.env.PORT || 5000;
app.listen(PORT, () => console.log(`Server ${PORT} portunda Ã§alÄ±ÅŸÄ±yor...`));
```

---

## **3. KullanÄ±cÄ± Modeli (Schema) OluÅŸturma**
MongoDBâ€™de **Mongoose kullanarak** bir `User` modeli tanÄ±mlayalÄ±m.

**`models/User.js`**
```javascript
import mongoose from 'mongoose';

const userSchema = new mongoose.Schema({
  name: { type: String, required: true },
  email: { type: String, required: true, unique: true },
  phone: { type: String, required: true }
});

const User = mongoose.model("User", userSchema);
export default User;
```

Bu model, **MongoDB koleksiyonunda** aÅŸaÄŸÄ±daki gibi bir yapÄ± oluÅŸturacak:
```json
{
  "_id": "651c7b2d7fbc5b001f8c6a5b",
  "name": "Ahmet YÄ±lmaz",
  "email": "ahmet@example.com",
  "phone": "555-1234"
}
```

---

## **4. API Endpointleri OluÅŸturma (CRUD Ä°ÅŸlemleri)**

Åimdi **Express.js** ile temel CRUD iÅŸlemlerini gerÃ§ekleÅŸtirecek API endpointlerini yazalÄ±m.

### **ğŸ“Œ 1. Yeni KullanÄ±cÄ± Ekleme (Create)**
```javascript
import express from 'express';
import User from '../models/User.js';

const router = express.Router();

// Yeni kullanÄ±cÄ± ekleme
router.post('/users', async (req, res) => {
  try {
    const { name, email, phone } = req.body;
    const newUser = new User({ name, email, phone });
    await newUser.save();
    res.status(201).json(newUser);
  } catch (error) {
    res.status(500).json({ message: "KullanÄ±cÄ± eklenirken hata oluÅŸtu", error });
  }
});

export default router;
```
**ğŸ› ï¸ Test iÃ§in:**  
Postman veya frontend Ã¼zerinden `POST http://localhost:5000/api/users` isteÄŸi gÃ¶nderin.  
Body kÄ±smÄ±na JSON formatÄ±nda veri ekleyin:

```json
{
  "name": "Elif Kaya",
  "email": "elif@example.com",
  "phone": "555-5678"
}
```

---

### **ğŸ“Œ 2. TÃ¼m KullanÄ±cÄ±larÄ± Getirme (Read - List)**
```javascript
// TÃ¼m kullanÄ±cÄ±larÄ± listeleme
router.get('/users', async (req, res) => {
  try {
    const users = await User.find();
    res.json(users);
  } catch (error) {
    res.status(500).json({ message: "KullanÄ±cÄ±lar getirilirken hata oluÅŸtu", error });
  }
});
```
**ğŸ› ï¸ Test iÃ§in:**  
`GET http://localhost:5000/api/users` isteÄŸi gÃ¶nderildiÄŸinde, tÃ¼m kullanÄ±cÄ±lar listelenir.

---

### **ğŸ“Œ 3. Tek Bir KullanÄ±cÄ±yÄ± Getirme (Read - By ID)**
```javascript
// ID ile kullanÄ±cÄ± getirme
router.get('/users/:id', async (req, res) => {
  try {
    const user = await User.findById(req.params.id);
    if (!user) return res.status(404).json({ message: "KullanÄ±cÄ± bulunamadÄ±" });
    res.json(user);
  } catch (error) {
    res.status(500).json({ message: "Hata oluÅŸtu", error });
  }
});
```
**ğŸ› ï¸ Test iÃ§in:**  
Ã–nce eklenen bir kullanÄ±cÄ±nÄ±n IDâ€™sini alÄ±p, `GET http://localhost:5000/api/users/{id}` isteÄŸi gÃ¶nderin.

---

### **ğŸ“Œ 4. KullanÄ±cÄ± Silme (Delete)**
```javascript
// KullanÄ±cÄ± silme
router.delete('/users/:id', async (req, res) => {
  try {
    const deletedUser = await User.findByIdAndDelete(req.params.id);
    if (!deletedUser) return res.status(404).json({ message: "KullanÄ±cÄ± bulunamadÄ±" });
    res.json({ message: "KullanÄ±cÄ± silindi", deletedUser });
  } catch (error) {
    res.status(500).json({ message: "Hata oluÅŸtu", error });
  }
});
```
**ğŸ› ï¸ Test iÃ§in:**  
Silmek istediÄŸiniz kullanÄ±cÄ±nÄ±n IDâ€™sini alÄ±n ve ÅŸu isteÄŸi gÃ¶nderin:  
`DELETE http://localhost:5000/api/users/{id}`  

---

## **5. API RotasÄ±nÄ± Sunucuya BaÄŸlama**
Son olarak, **server.js** iÃ§ine bu rotalarÄ± ekleyelim:

```javascript
import userRoutes from './routes/userRoutes.js';

app.use('/api', userRoutes);
```

---

## **API'yi Test Etme**
Åimdi API'mizi **Postman veya bir frontend projesi ile** test edebiliriz:

| **Ä°ÅŸlem** | **YÃ¶ntem** | **Endpoint** | **Body (JSON)** |
|-----------|----------|-------------|----------------|
| Yeni kullanÄ±cÄ± ekleme | `POST` | `/api/users` | `{ "name": "Ali", "email": "ali@mail.com", "phone": "12345" }` |
| TÃ¼m kullanÄ±cÄ±larÄ± listeleme | `GET` | `/api/users` | - |
| IDâ€™ye gÃ¶re kullanÄ±cÄ± getirme | `GET` | `/api/users/:id` | - |
| KullanÄ±cÄ± silme | `DELETE` | `/api/users/:id` | - |

---

## **SonuÃ§**
BÃ¶ylece **Mock verilerle Ã§alÄ±ÅŸan bir API oluÅŸturduk** ve:
âœ… **MongoDBâ€™ye baÄŸlantÄ± kurduk**  
âœ… **CRUD iÅŸlemleri iÃ§in API rotalarÄ± yazdÄ±k**  
âœ… **Yeni kullanÄ±cÄ± ekledik, listeledik, sildik**  

Bu yapÄ±yÄ± **frontend ile entegre etmek** veya **gÃ¼ncelleme (Update) iÅŸlemi eklemek** gibi adÄ±mlarla geniÅŸletebiliriz. ğŸš€