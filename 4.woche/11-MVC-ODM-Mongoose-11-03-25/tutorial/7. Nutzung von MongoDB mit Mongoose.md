### **MongoDBâ€™nin Mongoose ile KullanÄ±mÄ±**  

MongoDB, NoSQL bir veritabanÄ±dÄ±r ve **Mongoose**, MongoDB ile Node.js uygulamalarÄ±nda Ã§alÄ±ÅŸmayÄ± kolaylaÅŸtÄ±ran bir **ODM (Object Data Modeling) kÃ¼tÃ¼phanesidir**. Mongoose, **ÅŸema bazlÄ± yapÄ±, veri doÄŸrulama, middleware desteÄŸi ve iliÅŸkisel veri yÃ¶netimi** gibi birÃ§ok Ã¶zellik sunar.  

Bu rehberde **MongoDBâ€™yi Mongoose ile nasÄ±l kullanacaÄŸÄ±mÄ±zÄ±** adÄ±m adÄ±m Ã¶ÄŸreneceÄŸiz. ğŸš€  

---

## **1. MongoDB ve Mongoose Kurulumu**
Ä°lk olarak MongoDB ve Mongoose'u projemize ekleyelim.

### **ğŸ“Œ MongoDBâ€™yi Yerel Olarak Kurma**
EÄŸer bilgisayarÄ±nÄ±zda **MongoDB yÃ¼klÃ¼ deÄŸilse**, aÅŸaÄŸÄ±daki komutla yÃ¼kleyebilirsiniz:

#### **Mac/Linux (Homebrew ile)**
```bash
brew install mongodb-community@6.0
```
#### **Windows (Chocolatey ile)**
```bash
choco install mongodb
```
MongoDB'yi baÅŸlatmak iÃ§in:
```bash
mongod --dbpath /data/db
```

ğŸ‘‰ **Alternatif olarak, MongoDB Atlas kullanabilirsiniz** (Bulut tabanlÄ± MongoDB).

---

### **ğŸ“Œ Mongooseâ€™u Projeye Ekleme**
Node.js projesinde **Mongoose** kÃ¼tÃ¼phanesini yÃ¼klemek iÃ§in:
```bash
npm install mongoose
```

---

## **2. MongoDBâ€™ye BaÄŸlanma**
Mongoose kullanarak **MongoDB baÄŸlantÄ±sÄ±** oluÅŸturabiliriz.

### **ğŸ“Œ Ã–rnek: MongoDBâ€™ye BaÄŸlanma**
```javascript
import mongoose from "mongoose";

// MongoDB'ye baÄŸlan
mongoose.connect("mongodb://localhost:27017/myDatabase", {
  useNewUrlParser: true,
  useUnifiedTopology: true,
})
  .then(() => console.log("MongoDB baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ± ğŸš€"))
  .catch(err => console.log("MongoDB baÄŸlantÄ± hatasÄ± âŒ", err));
```

ğŸ‘‰ **MongoDB baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ± olduÄŸunda**, `MongoDB baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ± ğŸš€` mesajÄ± ekrana yazdÄ±rÄ±lÄ±r.  
ğŸ‘‰ **BaÄŸlantÄ± hatasÄ± durumunda**, hata mesajÄ± dÃ¶ndÃ¼rÃ¼lÃ¼r.  

---

## **3. Mongoose Model (Åema) OluÅŸturma**
MongoDB, **ÅŸemasÄ±z (schemaless)** bir veritabanÄ±dÄ±r. Ancak **Mongoose ile ÅŸema tanÄ±mlayarak veri yapÄ±sÄ±nÄ± belirleyebiliriz**.

### **ğŸ“Œ Ã–rnek: KullanÄ±cÄ± Modeli (User Schema)**
```javascript
const userSchema = new mongoose.Schema({
  name: { type: String, required: true },
  email: { type: String, required: true, unique: true },
  age: { type: Number, min: 18, required: true },
  createdAt: { type: Date, default: Date.now }
});

// Model oluÅŸturma
const User = mongoose.model("User", userSchema);

export default User;
```

### **ğŸ›  AÃ§Ä±klamalar**
- **Åema (`Schema`)**: `userSchema` iÃ§inde alanlarÄ±n tÃ¼rlerini ve doÄŸrulama kurallarÄ±nÄ± tanÄ±mlarÄ±z.
- **Model (`Model`)**: `mongoose.model("User", userSchema)` ile `User` modelini oluÅŸturduk.

ğŸ‘‰ **Modelimiz artÄ±k MongoDB'deki `users` koleksiyonuna baÄŸlanacak.**

---

## **4. CRUD Ä°ÅŸlemleri (Create, Read, Update, Delete)**
Mongoose kullanarak **CRUD iÅŸlemleri** gerÃ§ekleÅŸtirebiliriz.

---

### **ğŸ“Œ 1. Yeni Bir KullanÄ±cÄ± Ekleme (`Create`)**
```javascript
import User from "./models/user.js";

const newUser = new User({
  name: "Ali",
  email: "ali@example.com",
  age: 25
});

newUser
  .save()
  .then(() => console.log("KullanÄ±cÄ± baÅŸarÄ±yla kaydedildi âœ…"))
  .catch(err => console.log("Hata âŒ", err.message));
```

âœ… **KullanÄ±cÄ± baÅŸarÄ±yla veritabanÄ±na kaydedilir.**  

---

### **ğŸ“Œ 2. KullanÄ±cÄ±larÄ± Listeleme (`Read`)**
```javascript
User.find()
  .then(users => console.log("TÃ¼m KullanÄ±cÄ±lar:", users))
  .catch(err => console.log("Hata âŒ", err));
```
âœ… **TÃ¼m kullanÄ±cÄ±lar ekrana yazdÄ±rÄ±lÄ±r.**  

Belirli bir kullanÄ±cÄ±yÄ± bulmak iÃ§in:
```javascript
User.findOne({ email: "ali@example.com" })
  .then(user => console.log("KullanÄ±cÄ± bulundu:", user))
  .catch(err => console.log("Hata âŒ", err));
```
âœ… **E-posta adresine gÃ¶re kullanÄ±cÄ±yÄ± getirir.**

---

### **ğŸ“Œ 3. KullanÄ±cÄ± GÃ¼ncelleme (`Update`)**
```javascript
User.findOneAndUpdate({ email: "ali@example.com" }, { age: 30 }, { new: true })
  .then(updatedUser => console.log("GÃ¼ncellenmiÅŸ KullanÄ±cÄ±:", updatedUser))
  .catch(err => console.log("Hata âŒ", err));
```
âœ… **KullanÄ±cÄ±nÄ±n yaÅŸÄ± gÃ¼ncellenir ve yeni hali dÃ¶ndÃ¼rÃ¼lÃ¼r.**

---

### **ğŸ“Œ 4. KullanÄ±cÄ± Silme (`Delete`)**
```javascript
User.findOneAndDelete({ email: "ali@example.com" })
  .then(() => console.log("KullanÄ±cÄ± silindi âœ…"))
  .catch(err => console.log("Hata âŒ", err));
```
âœ… **Belirtilen kullanÄ±cÄ± veritabanÄ±ndan kaldÄ±rÄ±lÄ±r.**  

---

## **5. Ä°liÅŸkisel Veri KullanÄ±mÄ± (`populate`)**
MongoDB iliÅŸkisel bir veritabanÄ± deÄŸildir. Ancak **Mongoose ile `populate()` fonksiyonunu kullanarak iliÅŸkileri yÃ¶netebiliriz**.

### **ğŸ“Œ Ã–rnek: KullanÄ±cÄ± ve GÃ¶nderileri (User - Post Ä°liÅŸkisi)**
```javascript
const postSchema = new mongoose.Schema({
  title: String,
  content: String,
  user: { type: mongoose.Schema.Types.ObjectId, ref: "User" }
});

const Post = mongoose.model("Post", postSchema);
```
Bir post (gÃ¶nderi) kaydedildiÄŸinde `user` alanÄ± ile ilgili kullanÄ±cÄ±nÄ±n **ObjectIdâ€™si** saklanÄ±r.

Åimdi `populate()` ile ilgili kullanÄ±cÄ±yÄ± Ã§ekelim:
```javascript
Post.find().populate("user").then(posts => console.log(posts));
```
âœ… **Bu kod, her gÃ¶nderinin sahibi olan kullanÄ±cÄ± bilgisini de getirir.**  

---

## **6. Middleware KullanÄ±mÄ±**
Mongoose, **Middleware (Orta Katman Ä°ÅŸlemleri)** desteÄŸi sunar. Ã–rneÄŸin, kullanÄ±cÄ± kaydedilmeden Ã¶nce ÅŸifreyi hashleyelim.

### **ğŸ“Œ Ã–rnek: KullanÄ±cÄ± Kaydetmeden Ã–nce Åifre Hashleme**
```javascript
import bcrypt from "bcrypt";

userSchema.pre("save", async function (next) {
  if (!this.isModified("password")) return next();
  this.password = await bcrypt.hash(this.password, 10);
  next();
});
```
âœ… **Åifre, veritabanÄ±na kaydedilmeden Ã¶nce otomatik olarak hash'lenir.**  

---

## **7. MongoDB BaÄŸlantÄ±sÄ±nÄ± Kapatma**
Uygulama sonlandÄ±ÄŸÄ±nda MongoDB baÄŸlantÄ±sÄ±nÄ± kapatabiliriz:
```javascript
mongoose.connection.close()
  .then(() => console.log("MongoDB baÄŸlantÄ±sÄ± kapatÄ±ldÄ±"))
  .catch(err => console.log("BaÄŸlantÄ± kapatma hatasÄ± âŒ", err));
```
âœ… **Uygulama kapandÄ±ÄŸÄ±nda veritabanÄ± baÄŸlantÄ±sÄ±nÄ± keser.**

---

## **SonuÃ§**
ğŸ¯ **Mongoose ile MongoDB kullanarak** ÅŸema oluÅŸturabilir, CRUD iÅŸlemleri yapabilir, iliÅŸkisel veri Ã§ekebilir ve middleware kullanabiliriz.  
ğŸ¯ **MongoDB ile Ã§alÄ±ÅŸmayÄ± daha dÃ¼zenli ve gÃ¼venli hale getirir.**  
ğŸ¯ **Ã–zellikle Node.js tabanlÄ± backend projelerinde en yaygÄ±n kullanÄ±lan kÃ¼tÃ¼phanelerden biridir.** ğŸš€