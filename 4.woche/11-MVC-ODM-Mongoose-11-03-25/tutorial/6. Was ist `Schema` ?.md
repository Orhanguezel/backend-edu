### **Mongoose `Schema` Nedir?**  

**`Schema`**, MongoDB'deki belgelerin (documents) yapÄ±sÄ±nÄ± belirleyen bir ÅŸablondur. **Mongoose'da schema (ÅŸema)**, **hangi tÃ¼rde veri saklanacaÄŸÄ±nÄ±, doÄŸrulama kurallarÄ±nÄ± ve varsayÄ±lan deÄŸerleri (default values) tanÄ±mlar**.  

MongoDB, **ÅŸemasÄ±z (schemaless)** bir yapÄ±ya sahip olduÄŸu iÃ§in veriler esnek bir ÅŸekilde saklanabilir. Ancak, bu durum veri tutarsÄ±zlÄ±klarÄ±na yol aÃ§abilir. **Mongoose `Schema` kullanarak veri yapÄ±sÄ±nÄ± kesinleÅŸtirebiliriz.**  

---

## **1. Mongoose Schema TanÄ±mlama**
**ğŸ“Œ Ã–rnek: KullanÄ±cÄ± ÅemasÄ± (`User Schema`)**
```javascript
import mongoose from "mongoose";

// KullanÄ±cÄ± ÅemasÄ± TanÄ±mlama
const userSchema = new mongoose.Schema({
  name: { type: String, required: true },  // Zorunlu alan
  age: { type: Number, required: true, min: 18 }, // Minimum yaÅŸ 18
  email: { type: String, required: true, unique: true }, // Benzersiz (unique) e-posta
  createdAt: { type: Date, default: Date.now }, // VarsayÄ±lan olarak ÅŸu anki tarih
});

// Model oluÅŸturma
const User = mongoose.model("User", userSchema);

export default User;
```

### **ğŸ›  AÃ§Ä±klamalar:**
- `name`: **String tÃ¼rÃ¼nde**, **zorunlu (required)**.
- `age`: **Number tÃ¼rÃ¼nde**, **minimum deÄŸeri 18 olarak ayarlanmÄ±ÅŸ**.
- `email`: **Benzersiz (unique) olmasÄ± gereken bir e-posta**.
- `createdAt`: **VarsayÄ±lan olarak ÅŸu anki tarih atanÄ±r** (`default: Date.now`).

---

## **2. Schema ile DoÄŸrulama KurallarÄ± (Validation)**
### **ğŸ“Œ Temel DoÄŸrulamalar**
| Ã–zellik | AÃ§Ä±klama |
|---------|---------|
| `type` | Veri tÃ¼rÃ¼nÃ¼ belirler (`String`, `Number`, `Boolean`, `Date`, vb.) |
| `required` | AlanÄ±n zorunlu olup olmadÄ±ÄŸÄ±nÄ± belirler |
| `unique` | DeÄŸerin veritabanÄ±nda benzersiz olmasÄ±nÄ± saÄŸlar |
| `default` | VarsayÄ±lan bir deÄŸer atar |
| `min` | SayÄ±sal alanlar iÃ§in minimum deÄŸeri belirler |
| `max` | SayÄ±sal alanlar iÃ§in maksimum deÄŸeri belirler |
| `enum` | Belirli deÄŸerler arasÄ±ndan seÃ§im yapmaya zorlar |
| `match` | Regex ile belirli bir formatÄ± zorunlu kÄ±lar |

---

### **ğŸ“Œ Ã–rnek: Daha GeliÅŸmiÅŸ KullanÄ±cÄ± ÅemasÄ±**
```javascript
const userSchema = new mongoose.Schema({
  username: { type: String, required: true, unique: true, minlength: 3 },
  password: { type: String, required: true, minlength: 6 },
  email: { 
    type: String, 
    required: true, 
    unique: true, 
    match: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ 
  },
  age: { type: Number, min: 18, max: 65 }, // YaÅŸ sÄ±nÄ±rÄ± 18-65
  role: { type: String, enum: ["admin", "user", "editor"], default: "user" }, // Belirli roller
  createdAt: { type: Date, default: Date.now }
});
```
âœ… **E-posta formatÄ± zorunlu kÄ±lÄ±nÄ±r.**  
âœ… **Åifre en az 6 karakter olmalÄ±dÄ±r.**  
âœ… **YaÅŸ 18-65 aralÄ±ÄŸÄ±nda olmalÄ±dÄ±r.**  
âœ… **KullanÄ±cÄ±nÄ±n rolÃ¼ sadece "admin", "user" veya "editor" olabilir.**  

---

## **3. Schema'da `Methods` ve `Statics` KullanÄ±mÄ±**
Mongoose, schemaâ€™ya Ã¶zel **method (metodlar)** ve **statics (statik metodlar)** eklememizi saÄŸlar.

### **ğŸ“Œ 1. Instance Method (Belirli bir kayÄ±t iÃ§in geÃ§erlidir)**
Bir ÅŸifre doÄŸrulama fonksiyonu ekleyelim:
```javascript
import bcrypt from "bcrypt";

userSchema.methods.checkPassword = async function (password) {
  return await bcrypt.compare(password, this.password);
};
```
âœ… **Bu fonksiyon, bir kullanÄ±cÄ±nÄ±n ÅŸifresini doÄŸrulamak iÃ§in kullanÄ±labilir.**  

### **ğŸ“Œ 2. Static Method (TÃ¼m model iÃ§in Ã§alÄ±ÅŸÄ±r)**
EÄŸer `email` alanÄ±na gÃ¶re kullanÄ±cÄ± bulmak istersek:
```javascript
userSchema.statics.findByEmail = function (email) {
  return this.findOne({ email });
};
```
âœ… **TÃ¼m kullanÄ±cÄ±lar iÃ§inde belirli bir e-posta adresine sahip olanÄ± bulmak iÃ§in kullanÄ±labilir.**  

---

## **4. Virtuals (Sanal Alanlar)**
BazÄ± durumlarda, veritabanÄ±nda saklanmayan ancak **hesaplanarak dÃ¶ndÃ¼rÃ¼len** alanlara ihtiyacÄ±mÄ±z olabilir.  

### **ğŸ“Œ Ã–rnek: Tam Ad (fullName) AlanÄ±**
```javascript
userSchema.virtual("fullName").get(function () {
  return `${this.firstName} ${this.lastName}`;
});
```
âœ… **Bu Ã¶zellik, `firstName` ve `lastName` alanlarÄ±nÄ± birleÅŸtirerek dÃ¶ndÃ¼rÃ¼r.**  
âœ… **VeritabanÄ±nda tutulmaz, yalnÄ±zca talep edildiÄŸinde hesaplanÄ±r.**  

---

## **5. Middleware (Orta Katman Ä°ÅŸlemleri)**
Mongoose, belirli iÅŸlemlerden **Ã¶nce (pre)** veya **sonra (post)** otomatik olarak Ã§alÄ±ÅŸtÄ±rÄ±labilecek **middleware** destekler.

### **ğŸ“Œ Ã–rnek: KullanÄ±cÄ± Kaydetmeden Ã–nce Åifre Hashleme**
```javascript
import bcrypt from "bcrypt";

userSchema.pre("save", async function (next) {
  if (!this.isModified("password")) return next();
  this.password = await bcrypt.hash(this.password, 10);
  next();
});
```
âœ… **KullanÄ±cÄ± kaydedilmeden Ã¶nce ÅŸifre otomatik olarak hash'lenir.**  

---

## **6. Ä°liÅŸkisel Veri KullanÄ±mÄ± (`ref` ve `populate`)**
MongoDB, iliÅŸkisel bir veritabanÄ± deÄŸildir. Ancak Mongoose'un `ref` Ã¶zelliÄŸi sayesinde **iliÅŸkisel veri kullanabiliriz.**

### **ğŸ“Œ Ã–rnek: KullanÄ±cÄ± ve Blog YazÄ±larÄ± ArasÄ±ndaki Ä°liÅŸki**
```javascript
const postSchema = new mongoose.Schema({
  title: String,
  content: String,
  user: { type: mongoose.Schema.Types.ObjectId, ref: "User" }
});
```
Bu ÅŸema ile **her blog yazÄ±sÄ± belirli bir kullanÄ±cÄ±ya baÄŸlanabilir.**  
Ä°lgili kullanÄ±cÄ±yÄ± getirirken `populate()` metodunu kullanÄ±rÄ±z:

```javascript
Post.find().populate("user").then(posts => console.log(posts));
```
âœ… **`populate()` ile iliÅŸkisel veri Ã§ekmek mÃ¼mkÃ¼ndÃ¼r.**  

---

## **7. Schemaâ€™yÄ± Model Olarak Kullanma**
Son olarak, oluÅŸturduÄŸumuz `Schema`'yÄ± bir model olarak tanÄ±mlayalÄ±m.

```javascript
const User = mongoose.model("User", userSchema);
export default User;
```
âœ… **ArtÄ±k `User` modelini kullanarak CRUD iÅŸlemleri yapabiliriz.**  

---

## **SonuÃ§**
ğŸ”¹ **Mongoose `Schema`, MongoDBâ€™deki veri yapÄ±sÄ±nÄ± belirler.**  
ğŸ”¹ **DoÄŸrulama (validation), varsayÄ±lan deÄŸerler, iliÅŸkiler ve middleware kullanabiliriz.**  
ğŸ”¹ **`Methods`, `Statics`, `Virtuals`, `Middleware` ve `Populate` gibi geliÅŸmiÅŸ Ã¶zellikler sunar.**  
ğŸ”¹ **MongoDB ile Ã§alÄ±ÅŸÄ±rken veri yapÄ±sÄ±nÄ± daha tutarlÄ± ve yÃ¶netilebilir hale getirir.** ğŸš€