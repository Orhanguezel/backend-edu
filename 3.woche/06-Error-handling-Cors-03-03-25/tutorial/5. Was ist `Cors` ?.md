## **CORS (Cross-Origin Resource Sharing) Nedir?**

**CORS (Cross-Origin Resource Sharing)**, **farklÄ± kaynaklar (domain, protokol veya portlar) arasÄ±nda yapÄ±lan HTTP isteklerinin gÃ¼venli bir ÅŸekilde paylaÅŸÄ±lmasÄ±nÄ± saÄŸlayan** bir gÃ¼venlik mekanizmasÄ±dÄ±r.

---

## **1. CORSâ€™un Temel Problemi: AynÄ± Kaynak PolitikasÄ± (Same-Origin Policy - SOP)**
**VarsayÄ±lan olarak, web tarayÄ±cÄ±larÄ± yalnÄ±zca aynÄ± kaynaktan gelen istekleri kabul eder.**  
Bu gÃ¼venlik kuralÄ±na **Same-Origin Policy (SOP)** denir.

âœ” **AynÄ± kaynak sayÄ±lÄ±r:**  
- `https://example.com/page1.html` â†’ `https://example.com/api/data`
- `http://localhost:3000` â†’ `http://localhost:3000/api/users`

âŒ **FarklÄ± kaynak sayÄ±lÄ±r:**  
- `https://example.com` â†’ `https://api.example.com` (**alt domain farklÄ±**)
- `https://example.com` â†’ `https://another-site.com` (**farklÄ± domain**)
- `http://localhost:3000` â†’ `http://localhost:5000` (**farklÄ± port**)

**SonuÃ§:** TarayÄ±cÄ±lar, SOP nedeniyle **farklÄ± bir kaynaktan yapÄ±lan istekleri engeller**. Ancak bazen farklÄ± kaynaklardan veri almak gerekebilir. Ä°ÅŸte burada **CORS devreye girer**.

---

## **2. CORS NasÄ±l Ã‡alÄ±ÅŸÄ±r?**
CORS, **sunucunun tarayÄ±cÄ±ya hangi kaynaklardan (origin) istek kabul ettiÄŸini bildirerek** SOP kÄ±sÄ±tlamalarÄ±nÄ± aÅŸmasÄ±nÄ± saÄŸlar.

ğŸ”¹ Sunucu, **CORS baÅŸlÄ±klarÄ±nÄ± (CORS headers)** ekleyerek belirli kaynaklardan gelen isteklere izin verebilir.  
ğŸ”¹ EÄŸer **izin verilen bir kaynaktan (origin) istek gelirse**, tarayÄ±cÄ± isteÄŸe izin verir.  
ğŸ”¹ EÄŸer izin verilmeyen bir kaynaktan istek yapÄ±lÄ±rsa, **CORS hatasÄ± (CORS policy error)** oluÅŸur.

**Ã–rnek Ä°zin Verilen YanÄ±t (CORS BaÅŸlÄ±klarÄ± Ä°Ã§eren HTTP YanÄ±tÄ±):**
```http
HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
```

---

## **3. CORS BaÅŸlÄ±klarÄ±**
CORS mekanizmasÄ± ÅŸu Ã¶nemli baÅŸlÄ±klarla Ã§alÄ±ÅŸÄ±r:

### **1ï¸âƒ£ Access-Control-Allow-Origin**
Hangi domain'lerden gelen isteklere izin verileceÄŸini belirler.

- **Tek bir domain izin ver:**  
  ```http
  Access-Control-Allow-Origin: https://example.com
  ```
- **TÃ¼m domainlere izin ver:**  
  ```http
  Access-Control-Allow-Origin: *
  ```
  â— Bu, gÃ¼venlik riskleri yaratabilir.

### **2ï¸âƒ£ Access-Control-Allow-Methods**
Ä°zin verilen HTTP metodlarÄ±nÄ± belirler.

```http
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
```

### **3ï¸âƒ£ Access-Control-Allow-Headers**
Ä°zin verilen Ã¶zel baÅŸlÄ±klarÄ± belirler.

```http
Access-Control-Allow-Headers: Content-Type, Authorization
```

### **4ï¸âƒ£ Access-Control-Allow-Credentials**
Kimlik bilgileri (Ã§erezler, oturumlar, token'lar) ile isteklere izin verir.

```http
Access-Control-Allow-Credentials: true
```

---

## **4. CORS HatasÄ± ve Ã‡Ã¶zÃ¼mÃ¼**
**Hata Ã–rneÄŸi (TarayÄ±cÄ± Konsolu'nda GÃ¶rÃ¼nen CORS HatasÄ±):**
```
Access to fetch at 'https://api.example.com/data' from origin 'http://localhost:3000' has been blocked by CORS policy.
```
ğŸ”´ **Sebep:** Sunucu, `http://localhost:3000`'dan gelen isteklere izin vermiyor.  

âœ… **Ã‡Ã¶zÃ¼m:** Sunucu tarafÄ±nda CORS ayarlarÄ±nÄ± yapÄ±landÄ±rarak `localhost:3000`'a izin vermek gerekir.

---

## **5. Express.js ile CORS Ayarlama**
Node.js ve Express kullanarak **CORS'u aÃ§mak iÃ§in** `cors` paketini kullanabiliriz.

### **ğŸ“Œ CORS'u AÃ§mak (TÃ¼m Kaynaklara Ä°zin Ver)**
```javascript
const express = require('express');
const cors = require('cors');

const app = express();
app.use(cors()); // TÃ¼m kaynaklara izin ver

app.get('/data', (req, res) => {
  res.json({ message: "CORS aktif!" });
});

app.listen(5000, () => console.log('Server Ã§alÄ±ÅŸÄ±yor'));
```

âš  **GÃ¼venlik aÃ§Ä±sÄ±ndan sadece belirli kaynaklara izin vermek daha iyidir!**

---

### **ğŸ“Œ Belirli Bir Domainâ€™e Ä°zin Vermek**
```javascript
app.use(cors({
  origin: 'https://example.com', // Sadece example.com'a izin ver
  methods: ['GET', 'POST'], // Sadece GET ve POST izinli
  credentials: true // Ã‡erezlere izin ver
}));
```

---

## **6. CORS ile Preflight Ä°stekleri (OPTIONS)**
BazÄ± istekler, **tarayÄ±cÄ± tarafÄ±ndan otomatik olarak "preflight request" adÄ± verilen OPTIONS isteÄŸiyle test edilir.**  
Preflight, sunucunun isteÄŸe izin verip vermediÄŸini kontrol eder.

ğŸ’¡ **Preflight isteÄŸi ÅŸu baÅŸlÄ±klarla gÃ¶nderilir:**
```http
OPTIONS /data HTTP/1.1
Origin: http://localhost:3000
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type
```
ğŸ’¡ **Sunucu, aÅŸaÄŸÄ±daki yanÄ±tÄ± verirse istek devam eder:**
```http
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: POST
Access-Control-Allow-Headers: Content-Type
```

---

## **Ã–zet**
- **CORS**, tarayÄ±cÄ±larÄ±n gÃ¼venlik amacÄ±yla farklÄ± kaynaklardan yapÄ±lan istekleri kÄ±sÄ±tlamasÄ±nÄ± yÃ¶neten bir mekanizmadÄ±r.
- **Same-Origin Policy (SOP)** nedeniyle, farklÄ± domainlerden gelen istekler engellenir.
- **CORS baÅŸlÄ±klarÄ±** eklenerek farklÄ± domainlerden isteklere izin verilebilir.
- **Node.js & Express'te `cors` paketi** kullanarak CORS aÃ§Ä±labilir.
- **Preflight istekleri**, tarayÄ±cÄ±nÄ±n gÃ¼venlik kontrolÃ¼ yaptÄ±ÄŸÄ± ekstra isteklerdir.

ğŸš€ **SonuÃ§:** CORS, web APIâ€™lerinde sÄ±kÃ§a karÅŸÄ±laÅŸÄ±lan bir konudur ve uygun ÅŸekilde yapÄ±landÄ±rÄ±lmalÄ±dÄ±r!